import re
from urllib.parse import urljoin, urlparse
import scrapy
from scraper.items import EmailAddressItem
from scrapy.linkextractors import IGNORED_EXTENSIONS

def get_extension_ignore_url_params(url):
    # conveniently lops off all params leaving just the path
    path = urlparse(url).path
    extension = re.search('\.([a-zA-Z0-9]+$)', path)
    if extension is not None:
        return extension.group(1)
    else:
        return "none"  # don't want to return NoneType, it will break comparisons later


class EmailSpider(scrapy.Spider):
    name = "customspider"

    def __init__(self, domain=None, subdomain_exclusions=[], crawl_js=False):

        self.start_urls = [
            'https://www.capital.sp.gov.br',
            'https://www.pmf.sc.gov.br',
            'https://www.curitiba.pr.gov.br',
            'https://www.campinas.sp.gov.',
            'https://www.vitoria.es.gov.',
            'https://www.saocaetanodosul.sp.gov.br',
            'https://www.santos.sp.gov.br',
            'http://www.brasilia.df.gov.',
            'https://prefeitura.poa.br',
            'https://prefeitura.pbh.gov.',
            'http://www.niteroi.rj.gov.br',
            'https://prefeitura.rio',
            'http://www.barueri.sp.gov.',
            'http://www.campogrande.ms.gov.br',
            'http://www.recife.pe.gov.',
            'https://www.bc.sc.gov.',
            'https://jaguariuna.sp.gov.',
            'https://www.itajai.sc.gov.',
            'https://www.blumenau.sc.gov.',
            'https://www.sjc.sp.gov.',
            'https://www.vinhedo.sp.gov.',
            'https://jundiai.sp.gov.',
            'https://www.joinville.sc.gov.',
            'http://www2.maringa.pr.gov.br/site',
            'https://www.londrina.pr.gov.',
            'http://www.praiagrande.sp.gov.',
            'http://www.salvador.ba.gov.',
            'https://www.saobernardo.sp.gov.br/prefeitu',
            'https://www.fortaleza.ce.gov.',
            'https://www.sorocaba.sp.gov.',
            'https://www.ribeiraopreto.sp.gov.br/portal',
            'https://www.prefeituradepalmas.org',
            'https://www.santoandre.sp.gov.',
            'https://www.vicosa.mg.gov.',
            'https://www.pjf.mg.gov.',
            'https://www.goiania.go.gov.',
            'http://www.paulinia.sp.gov.',
            'https://pmt.pi.gov.br',
            'https://www.santanadeparnaiba.sp.gov.',
            'https://www.limeira.sp.gov.',
            'https://www.riopreto.sp.gov.',
            'https://www.santamaria.rs.gov.',
            'https://www.indaiatuba.sp.gov.br',
            'http://www.piracicaba.sp.gov.',
            'https://novalima.mg.gov.',
            'https://linhares.es.gov.',
            'https://www.americana.sp.gov.',
            'http://www.presidenteprudente.sp.gov.br/site/index.xht',
            'http://patobranco.pr.gov.',
            'https://www.resende.rj.gov.br',
            'https://cascavel.atende.n',
            'https://www.chapeco.sc.gov.br',
            'http://www.uberaba.mg.gov.',
            'https://itu.sp.gov.',
            'http://www.betim.mg.gov.br/home',
            'https://www.petropolis.rj.gov.',
            'http://www.macae.rj.gov.br',
            'http://www.itatiba.sp.gov.',
            'https://araras.sp.gov.br/home',
            'http://eusebio.ce.gov.',
            'https://www.ipatinga.mg.gov.br',
            'https://www.jaraguadosul.sc.gov.',
            'http://www.valinhos.sp.gov.',
            'https://itumbiara.go.gov.',
            'http://www.osasco.sp.gov.',
            'https://www.amparo.sp.gov.br',
            'https://www.cachoeiro.es.gov.',
            'https://www.manaus.am.gov.',
            'https://www.ouropreto.mg.gov.br',
            'http://www.saocarlos.sp.gov.br',
            'https://www.itupeva.sp.gov.br',
            'https://www.uberlandia.mg.gov.',
            'https://www.caraguatatuba.sp.gov.',
            'http://www.lencoispaulista.sp.gov.',
            'https://www.natal.rn.gov.',
            'https://cajamar.sp.gov.br',
            'https://www.congonhas.mg.gov.',
            'https://www.joaopessoa.pb.gov.br',
            'https://www5.pmfi.pr.gov.br',
            'https://www.botucatu.sp.gov.br',
            'http://www.jaboticabal.sp.gov.',
            'http://www.sobral.ce.gov.br',
            'https://www.itapema.sc.gov.',
            'http://www.treslagoas.ms.gov.',
            'https://www.jacarei.sp.gov.br',
            'https://prefeituradepoa.sp.gov.br',
            'http://www.sjp.pr.gov.',
            'https://cotia.sp.gov.',
            'https://www.mariana.mg.gov.',
            'https://www.itabira.mg.gov.',
            'http://www2.hortolandia.sp.gov.br',
            'https://www.andradina.sp.gov.',
            'https://www.pmvc.ba.gov.',
            'https://caxias.rs.gov.',
            'https://www.cuiaba.mt.gov.',
            'https://www.toledo.pr.gov.br',
            'https://www.colatina.es.gov.br',
            'https://www.registro.sp.gov.',
            'http://www.araraquara.sp.gov.br',
            'http://www.boituva.sp.gov.',
            'https://www.braganca.sp.gov.br',
            'http://www.diadema.sp.gov.br',
            'https://www.marilia.sp.gov.',
            'http://www.catanduva.sp.gov.',
            'https://new.voltaredonda.rj.gov.',
            'https://portal.montesclaros.mg.gov.br',
            'https://www.portoferreira.sp.gov.br',
            'https://www2.tatui.sp.gov.',
            'https://www.bauru.sp.gov.',
            'https://www.franciscobeltrao.pr.gov.',
            'http://www.contagem.mg.gov.',
            'https://pocosdecaldas.mg.gov.br',
            'https://salto.sp.gov.',
            'https://www.vilavelha.es.gov.',
            'https://www.lajeado.rs.gov.br',
            'https://www.guarulhos.sp.gov.',
            'https://aracatuba.sp.gov.',
            'http://patosdeminas.mg.gov.br/home',
            'https://www.ubatuba.sp.gov.',
            'https://campolargo.atende.net',
            'https://www.varginha.mg.gov.',
            'http://www.fernandopolis.sp.gov.',
            'http://www.riobranco.ac.gov.',
            'http://www.apucarana.pr.gov.br/site',
            'https://www.dourados.ms.gov.',
            'https://www.taubate.sp.gov.',
            'https://www.mogiguacu.sp.gov.',
            'https://www.sertaozinho.sp.gov.br',
            'https://www.ipojuca.pe.gov.br',
            'https://www.lins.sp.gov.br',
            'https://novo.anapolis.go.gov.',
            'https://www.laurodefreitas.ba.gov.br/2021',
            'https://www.lavras.mg.gov.',
            'https://www.rioclaro.sp.gov.',
            'http://www.umuarama.pr.gov.',
            'https://palhoca.atende.net',
            'https://itapira.sp.gov.',
            'http://www.mogimirim.sp.gov.br',
            'https://pousoalegre.mg.gov.',
            'http://www.prefeituradeatibaia.com.br',
            'https://www.barretos.sp.gov.br',
            'http://www.itanhaem.sp.gov.',
            'https://www.pmnf.rj.gov.',
            'http://www.gurupi.to.gov.',
            'https://www.portonacional.to.gov.br',
            'https://www.setelagoas.mg.gov.br',
            'https://www6.juazeiro.ba.gov.br',
            'https://riodosul.atende.net',
            'http://www.birigui.sp.gov.',
            'http://www.prefeituradearuja.sp.gov.',
            'https://www.prefeiturademossoro.com.',
            'https://pinhais.atende.net',
            'http://www.mogidascruzes.sp.gov.',
            'https://www.maua.sp.gov.br',
            'https://www.pmerechim.rs.gov.',
            'https://www.aracaju.se.gov.br',
            'https://www.juazeirodonorte.ce.gov.br',
            'https://www.araxa.mg.gov.',
            'https://www.olimpia.sp.gov.br',
            'https://www.votorantim.sp.gov.br',
            'http://www.rondonopolis.mt.gov.br',
            'https://crato.ce.gov.br',
            'http://www.cubatao.sp.gov.br',
            'http://www.saosebastiao.sp.gov.br',
            'https://www.criciuma.sc.gov.br/site',
            'https://www.fazendariogrande.pr.gov.br',
            'https://muriae.mg.gov.br',
            'http://www.bertioga.sp.gov.br',
            'https://www.caieiras.sp.gov.br',
            'https://www.saojoao.sp.gov.br',
            'https://www.novohamburgo.rs.gov.br',
            'https://www.itauna.mg.gov.br',
            'https://parademinas.mg.gov.br',
            'https://www.lucasdorioverde.mt.gov.br',
            'https://www.assis.sp.gov.br',
            'https://campinagrande.pb.gov.br',
            'https://www.pelotas.com.br',
            'https://www.paranagua.pr.gov.br',
            'https://www.avare.sp.gov.br',
            'https://tresrios.rj.gov.br',
            'http://bentogoncalves.rs.gov.br',
            'https://www.campos.rj.gov.br',
            'http://www.belem.pa.gov.br',
            'https://www.jatai.go.gov.br',
            'https://www.tubarao.sc.gov.br',
            'https://www.guaruja.sp.gov.br',
            'https://araucaria.atende.net',
            'https://www.rioverde.go.gov.br',
            'https://www.barramansa.rj.gov.br',
            'http://www.camposdojordao.sp.gov.br',
            'http://www.lorena.sp.gov.',
            'https://petrolina.pe.gov.br',
            'http://www.pmpf.rs.gov.br',
            'https://www.batatais.sp.gov.br',
            'https://www.feiradesantana.ba.gov.br',
            'https://www.valadares.mg.gov.br',
            'https://www.canoas.rs.gov.br',
            'https://cabedelo.pb.gov.br',
            'https://saojose.sc.gov.br',
            'https://www.montemor.sp.gov.br',
            'https://saoluis.ma.gov.br',
            'https://www.pontagrossa.pr.gov.br',
            'https://www.itapecerica.sp.gov.br',
            'https://cacapava.sp.gov.br',
            'http://www.itajuba.mg.gov.br',
            'https://www.saojoaodelrei.mg.gov.br',
            'http://www.novaodessa.sp.gov.br',
            'https://www.portofeliz.sp.gov.br',
            'https://www.itapetininga.sp.gov.br',
            'https://www.maracanau.ce.gov.br',
            'https://www.riodasostras.rj.gov.br',
            'https://www.pirapora.mg.gov.br',
            'http://www.catalao.go.gov.br/site',
            'https://www.jandira.sp.gov.br',
            'http://cidadeembudasartes.sp.gov.br/embu/port',
            'http://ts.sp.gov.br',
            'http://www.serra.es.gov.br',
            'https://portal.brusque.sc.gov.br',
            'https://jaboatao.pe.gov.br',
            'http://www.cambe.pr.gov.br/site',
            'https://www.pmc.sc.gov.br',
            'https://concordia.atende.net',
            'http://barbacena.mg.gov.br/2',
            'http://www.maceio.al.gov.br',
            'https://www.paranavai.pr.gov.br',
            'https://www.pindamonhangaba.sp.gov.br',
            'https://www.santacruz.rs.gov.br',
            'http://portal.mococa.sp.gov.br/principal',
            'https://campomourao.atende.net',
            'https://primaveradoleste.mt.gov.br',
            'http://www.alfenas.mg.gov.br',
            'https://portal.varzeapaulista.sp.gov.br',
            'https://russas.ce.gov.br',
            'https://www.venancioaires.rs.gov.br',
            'https://www.itabirito.mg.gov.br',
            'http://www.peruibe3.sp.gov.br',
            'http://pirassununga.sp.gov.br',
            'https://www.leme.sp.gov.br',
            'https://camboriu.sc.gov.br',
            'http://www.santabarbara.sp.gov.br/v5',
            'https://www.divinopolis.mg.gov.br',
            'https://www.tupa.sp.gov.br',
            'http://www.capaodacanoa.rs.gov.br/site/ho',
            'https://www.saocristovao.se.gov.br',
            'https://sumare.atende.net /  # !/tipo/inici',
            'http://www.angra.rj.gov.br',
            'https://www.videira.sc.gov.br',
            'http://www.votuporanga.sp.gov.br/novo',
            'https://www.corumba.ms.gov.br',
            'http://www.aracruz.es.gov.br',
            'https://caruaru.pe.gov.br',
            'https://portoseguro.ba.gov.br',
            'https://www.suzano.sp.gov.br/web',
            'https://www.marica.rj.gov.br',
            'https://www.guarapari.es.gov.br',
            'https://www.penapolis.sp.gov.br',
            'https://www.olinda.pe.gov.br',
            'https://www.saobentodosul.sc.gov.br',
            'https://www.portovelho.ro.gov.br',
            'https://parauapebas.pa.gov.br',
            'https://www.pontenova.mg.gov.br',
            'https://www.arapongas.pr.gov.br',
            'https://www.araguaina.to.gov.br/portal/index.p',
            'https://boavista.rr.gov.br',
            'https://mineiros.go.gov.br',
            'https://www.guarapuava.pr.gov.br',
            'https://www.vespasiano.mg.gov.br',
            'https://itapeva.sp.gov.br',
            'https://www.santarosa.rs.gov.br/index2.p',
            'http://uniaodavitoria.pr.gov.br',
            'https://www.ourinhos.sp.gov.br',
            'https://www.barreirinhas.ma.gov.br',
            'https://marechalcandidorondon.atende.net',
            'https://castro.atende.net',
            'https://www.esteio.rs.gov.br',
            'http://www.saojoaquimdabarra.sp.gov.br/ind',
            'https://www.ituiutaba.mg.gov.br',
            'https://www.mafra.sc.gov.br',
            'https://www.sinop.mt.gov.br',
            'https://www.ribeiraopires.sp.gov.br',
            'https://www.ijui.rs.gov.br',
            'http://cabofrio.rj.gov.br',
            'http://www.saomateus.es.gov.br',
            'https://www.franca.sp.gov.br',
            'https://caico.rn.gov.br',
            'https://www.vargemgrandepaulista.sp.gov.br/site',
            'https://www.gaspar.sc.gov.br',
            'https://parnamirim.rn.gov.br',
            'http://www.camacari.ba.gov.br',
            'http://novo.matao.sp.gov.br',
            'https://www.santoangelo.rs.gov.br',
            'https://irati.pr.gov.br',
            'https://www.jau.sp.gov.br',
            'https://itapevi.sp.gov.br',
            'http://conselheirolafaiete.mg.gov.br/v2',
            'https://pedroleopoldo.mg.gov.br',
            'https://www.uba.mg.gov.br',
            'http://www.caucaia.ce.gov.br',
            'https://www.novaiguacu.rj.gov.br',
            'https://www.santaluzia.mg.gov.br/v2',
            'https://www.paraiso.to.gov.br',
            'https://www.mirassol.sp.gov.br',
            'http://www.guanambi.ba.gov.br',
            'https://gravatai.atende.net',
            'http://www.portal.patrocinio.mg.gov.br',
            'https://www.bebedouro.sp.gov.br/portal',
            'https://www.teofilootoni.mg.gov.br',
            'https://www.timoteo.mg.gov.br',
            'http://transparencia.brumado.ba.gov.br/transparenciamunicipal/brumado/home',
            'https://macapa.ap.gov.br',
            'https://pmjm.mg.gov.br',
            'https://www.formiga.mg.gov.br',
            'https://www.ilheus.ba.gov.br',
            'https://prefeitura.cabo.pe.gov.br',
            'https://www.cacador.sc.gov.br',
            'https://indaial.atende.net',
            'https://www.cariacica.es.gov.br',
            'https://belojardim.pe.gov.br',
            'https://cosmopolis.sp.gov.br',
            'https://www.bomdespacho.mg.gov.br',
            'https://www.limoeirodonorte.ce.gov.br',
            'https://site.sorriso.mt.gov.br',
            'https://www.riogrande.rs.gov.br/pagina',
            'https://www.goiania.go.gov.br',
            'https://pmspa.rj.gov.br',
            'https://www.goianesia.go.gov.br',
            'https://www.altafloresta.mt.gov.br',
            'https://www.cianorte.pr.gov.br',
            'https://www.formosa.go.gov.br',
            'https://www.alegrete.rs.gov.br',
            'https://www.barradogarcas.mt.gov.br',
            'http://www.arturnogueira.sp.gov.br',
            'https://cachoeirinha.atende.net',
            'https://mongagua.sp.gov.br',
            'https://www.bage.rs.gov.br',
            'http://www.itabuna.ba.gov.br',
            'https://www.camaragibe.pe.gov.br',
            'https://www.pmna.ms.gov.br',
            'https://guaratingueta.sp.gov.br',
            'https://www.lages.sc.gov.br',
            'https://www.uruguaiana.rs.gov.br',
            'https://duquedecaxias.rj.gov.br',
            'https://www.manhuacu.mg.gov.br',
            'https://www.ararangua.sc.gov.br',
            'https://www.xanxere.sc.gov.br',
            'https://www.caratinga.mg.gov.br',
            'https://www.novavenecia.es.gov.br',
            'https://www.saquarema.rj.gov.br',
            'https://araguari.mg.gov.br',
            'https://quirinopolis.go.gov.br',
            'https://www.carazinho.rs.gov.br',
            'https://www.imperatriz.ma.gov.br',
            'https://teresopolis.rj.gov.br',
            'https://www.saoleopoldo.rs.gov.br',
            'https://ariquemes.ro.gov.br/pma-portal/public',
            'https://www.lagoasanta.mg.gov.br',
            'http://www.telemacoborba.pr.gov.br',
            'https://www.cacoal.ro.gov.br',
            'http://farroupilha.rs.gov.br',
            'https://meriti.rj.gov.br/home',
            'https://www.itaperuna.rj.gov.br',
            'https://www.trescoracoes.mg.gov.br',
            'https://www.campobom.rs.gov.br',
            'https://www.saovicente.sp.gov.br/publico',
            'https://www.aparecida.go.gov.br',
            'http://www.rolandia.pr.gov.br',
            'https://www.valenca.rj.gov.br',
            'http://www.vilhena.ro.gov.br',
            'https://www.itaquaquecetuba.sp.gov.br',
            'http://www.serratalhada.pe.gov.br',
            'https://www.prefeituradavitoria.pe.gov.br/site',
            'https://senadorcanedo.go.gov.br',
            'https://www.ssparaiso.mg.gov.br',
            'https://www.ribeiraodasneves.mg.gov.br',
            'http://montealto.sp.gov.br/site',
            'https://www.cruzdasalmas.ba.gov.br',
            'https://www.passos.mg.gov.br',
            'http://www.guaxupe.mg.gov.br',
            'http://www.colombo.pr.gov.br',
            'https://www.aquiraz.ce.gov.br',
            'https://www.sousa.pb.gov.br',
            'https://www.caldasnovas.go.gov.br',
            'https://www.navegantes.sc.gov.br',
            'https://www.paulista.pe.gov.br/site',
            'https://www.quixeramobim.ce.gov.br',
            'https://navirai.ms.gov.br',
            'http://patos.pb.gov.br',
            'https://www.campolimpopaulista.sp.gov.br/site',
            'https://www.saofranciscodosul.sc.gov.br',
            'http://www.carapicuiba.sp.gov.br',
            'https://www.embuguacu.sp.gov.br',
            'https://www.ibipora.pr.gov.br',
            'https://www.montenegro.rs.gov.br',
            'https://pontapora.ms.gov.br/v2',
            'https://www.bigua.sc.gov.br',
            'http://www.sapucaiadosul.rs.gov.br',
            'https://www.santoantoniododescoberto.go.gov.br/site',
            'https://www.estancia.se.gov.br',
            'https://www.saoroque.sp.gov.br',
            'http://www.cataguases.mg.gov.br',
            'http://www.estanciavelha.rs.gov.br',
            'https://saomigueldoscampos.al.gov.br',
            'https://www.prefeituradecachoeiras.com.br',
            'https://www.cachoeiradosul.rs.gov.br',
            'https://www.teixeiradefreitas.ba.gov.br',
            'https://cruzalta.atende.net',
            'https://www.fabriciano.mg.gov.br',
            'https://inhumas.go.gov.br',
            'https://itapipoca.ce.gov.br',
            'https://www.taquaritinga.sp.gov.br',
            'https://www.cangucu.rs.gov.br',
            'https://www.taua.ce.gov.br',
            'http://www.prefeituraunai.mg.gov.br',
            'https://planaltina.go.gov.br',
            'https://luiseduardomagalhaes.ba.gov.br',
            'https://www.candeias.mg.gov.br',
            'https://www.piedade.sp.gov.br',
            'http://www.bomjesusdalapa.ba.gov.br',
            'http://www.viana.es.gov.br',
            'https://www.saojosederibamar.ma.gov.br',
            'https://www.saogoncalo.rj.gov.br',
            'http://www.paracatu.mg.gov.br',
            'https://www.icara.sc.gov.br',
            'https://www.jacobina.ba.gov.br',
            'http://nilopolis.rj.gov.br/site',
            'https://www.saoborja.rs.gov.br',
            'https://www.granja.ce.gov.br',
            'https://www.horizonte.ce.gov.br',
            'https://lagoadaprata.mg.gov.br',
            'https://itamaraju.ba.gov.br',
            'https://saojosedoriopardo.sp.gov.br/2021',
            'https://aracati.ce.gov.br',
            'https://www.campobelo.mg.gov.br',
            'https://tangaradaserra.mt.gov.br',
            'http://site.sabara.mg.gov.br',
            'https://ibiuna.sp.gov.br',
            'https://www.tiangua.ce.gov.br',
            'https://www.balsas.ma.gov.br',
            'https://www.uniaodospalmares.al.gov.br',
            'https://www.crateus.ce.gov.br',
            'https://caetite.ba.gov.br',
            'https://janauba.mg.gov.br',
            'http://www.francodarocha.sp.gov.br',
            'https://quixada.ce.gov.br',
            'https://www.alagoinhas.ba.gov.br',
            'http://saogoncalodoamarante.ce.gov.br/portal',
            'http://www.varzeagrande.mt.gov.br',
            'https://www.salgueiro.pe.gov.br',
            'https://pacatuba.ce.gov.br',
            'http://www.mesquita.rj.gov.br/pmm',
            'https://www.vacaria.rs.gov.br',
            'http://www.itapetinga.ba.gov.br',
            'http://www.mairipora.sp.gov.br',
            'http://www.jequie.ba.gov.br',
            'https://www.trespontas.mg.gov.br',
            'https://santaisabel.sp.gov.br/portal',
            'https://barbalha.ce.gov.br',
            'https://www.novaserrana.mg.gov.br',
            'https://palmeiradosindios.al.gov.br',
            'https://pesqueira.pe.gov.br',
            'https://assu.rn.gov.br',
            'http://www2.caceres.mt.gov.br',
            'https://cajazeiras.pb.gov.br',
            'https://www.escada.pe.gov.br',
            'https://www.cidadeocidental.go.gov.br',
            'http://www.cruzeiro.sp.gov.br/page/home.a',
            'https://www.guarabira.pb.gov.br',
            'http://www.sdolivramento.com.br/prefeitura/index.p',
            'http://www.piraquara.pr.gov.br',
            'https://parnaiba.pi.gov.',
            'https://www.prefeituradegravata.pe.gov.br',
            'https://www.valparaisodegoias.go.gov.br',
            'https://www.coruripe.al.gov.br',
            'https://tefe.am.gov.br',
            'http://www.franciscomorato.sp.gov.br',
            'https://parobe.atende.net',
            'https://www.rolimdemoura.ro.gov.br',
            'https://curvelo.mg.gov.br/site',
            'https://iguatu.ce.gov.br',
            'https://paragominas.pa.gov.br',
            'http://timon.ma.gov.br/site',
            'https://www.tamandare.pr.gov.br',
            'https://irece.ba.gov.br',
            'https://www.prudentopolis.pr.gov.br',
            'http://ferrazdevasconcelos.sp.gov.br/web',
            'https://www.araruama.rj.gov.br',
            'http://www.itarare.sp.gov.br',
            'https://www.bacabal.ma.gov.br',
            'http://www.marechaldeodoro.al.gov.br',
            'https://capivari.sp.gov.br',
            'https://www.caninde.ce.gov.br',
            'https://garanhuns.pe.gov.br',
            'http://simoesfilho.ba.gov.br',
            'https://web.arapiraca.al.gov.br',
            'https://www.pacodolumiar.ma.gov.br',
            'https://guaiba.atende.net',
            'https://www.viamao.rs.gov.br',
            'http://www.sapiranga.rs.gov.br',
            'http://www.site.ji-parana.ro.gov.br',
            'http://www.pauloafonso.ba.gov.br/novo',
            'https://santarem.pa.gov.br',
            'https://paracambi.rj.gov.br',
            'https://www2.picos.pi.gov.br',
            'http://www.tramandai.rs.gov.br',
            'https://www.eunapolis.ba.gov.br',
            'https://www.ibitinga.sp.gov.br',
            'https://www.moradanova.ce.gov.br',
            'https://caxias.rs.gov.br',
            'http://www.castanhal.pa.gov.br',
            'https://www.oriximina.pa.gov.br',
            'https://riobonito.rj.gov.br',
            'https://www.ico.ce.gov.br',
            'http://www.frutal.mg.gov.br',
            'https://maraba.pa.gov.br',
            'https://mage.rj.gov.br',
            'https://www.barradopirai.rj.gov.br/portal',
            'https://www.paudalho.pe.gov.br/portal',
            'http://igarassu.pe.gov.br',
            'https://www.ibirite.mg.gov.br',
            'https://camocim.ce.gov.br',
            'https://timbauba.pe.gov.br',
            'http://abreuelima.pe.gov.br',
            'https://www.acarau.ce.gov.br',
            'http://cearamirim.rn.gov.br',
            'https://bezerros.pe.gov.br',
            'https://www.arcoverde.pe.gov.br/index',
            'https://www.valenca.rj.gov.br',
            'https://seropedica.rj.gov.br',
            'https://www.jaguaquara.ba.gov.br',
            'https://www.sidrolandia.ms.gov.br',
            'https://www.prefeiturasaj.ba.gov.br',
            'https://altamira.pa.gov.br',
            'https://itabaiana.se.gov.br',
            'http://jaru.ro.gov.br',
            'https://www.leopoldina.mg.gov.br',
            'http://serrinha.rn.gov.br',
            'https://www.trindade.go.gov.br',
            'https://www.santacruzdocapibaribe.pe.gov.br',
            'https://www.itaborai.rj.gov.br',
            'http://www.taquara.rs.gov.br',
            'https://www.alvorada.rs.gov.br',
            'https://www.senhordobonfim.ba.gov.br',
            'https://santana.ap.gov.br',
            'https://www.prefeituradesaofrancisco.mg.gov.br',
            'https://prefeituradecameta.pa.gov.br',
            'https://cristalina.go.gov.br',
            'https://slm.pe.gov.br',
            'https://www.araripina.pe.gov.br',
            'https://www.floriano.pi.gov.br',
            'https://www.camaqua.rs.gov.br',
            'https://cascavel.atende.net',
            'https://itaberaba.ba.gov.br',
            'https://ribeiradopombal.ba.gov.br',
            'https://www.jaraguadosul.sc.gov.br',
            'https://www.brejomdeus.pe.gov.br',
            'https://pmp.pr.gov.br/website',
            'https://prefeituradebelfordroxo.rj.gov.br',
            'https://www.saogabriel.rs.gov.br',
            'https://www.limoeiro.pe.gov.br',
            'https://www.vicosa.ce.gov.br',
            'https://www.saobentodouna.pe.gov.br',
            'https://www.diasdavila.ba.gov.br',
            'https://beberibe.ce.gov.br',
            'https://www.luziania.go.gov.br',
            'https://www.bayeux.pb.gov.br',
            'https://www.santarita.pb.gov.br',
            'https://parintins.am.gov.br',
            'https://maranguape.ce.gov.br',
            'https://tucurui.pa.gov.br',
            'https://aguaslindasdegoias.go.gov.br',
            'https://www.macaiba.rn.gov.br',
            'https://portalsocorro.link3.com.br',
            'http://www.santoamaro.ba.gov.br',
            'https://tobiasbarreto.se.gov.br',
            'https://itapaje.ce.gov.br',
            'https://www.delmirogouveia.al.gov.br',
            'https://santoestevao.ba.gov.br',
            'http://januaria.mg.gov.br/home',
            'https://www.boaviagem.ce.gov.br',
            'https://carpina.pe.gov.br',
            'https://www.codo.ma.gov.br',
            'https://www.grajau.ma.gov.br',
            'https://www.barcarena.pa.gov.br/portal/ho',
            'https://www.esmeraldas.mg.gov.br',
            'https://novogama.go.gov.br',
            'https://www.pacajus.ce.gov.br',
            'https://www.itaituba.pa.gov.br',
            'https://www.piripiri.pi.gov.br',
            'https://catu.ba.gov.br',
            'https://www.queimados.rj.gov.br',
            'http://www.surubim.pe.gov.br',
            'http://www.campoalegre.al.gov.br',
            'https://guapimirim.rj.gov.br',
            'https://rondondopara.pa.gov.br',
            'https://saomigueldoguama.pa.gov.br',
            'http://www.moreno.pe.gov.br/portal1',
            'https://www.acailandia.ma.gov.br/ho',
            'https://itaguai.rj.gov.br',
            'http://www.ananindeua.pa.gov.br/portal',
            'https://lagarto.se.gov.br',
            'https://penedo.al.gov.br',
            'https://www.acopiara.ce.gov.br',
            'https://jacunda.pa.gov.br',
            'https://www.trairi.ce.gov.br',
            'http://www.riograndedaserra.sp.gov.br',
            'https://www.tucano.ba.gov.br',
            'https://www.chapadinha.ma.gov.br',
            'https://santaizabel.pa.gov.br',
            'https://www.riolargo.al.gov.br',
            'http://campoformoso.ba.gov.br',
            'https://redencao.pa.gov.br',
            'https://www.manacapuru.am.gov.br',
            'https://ulianopolis.pa.gov.br',
            'https://breves.pa.gov.br',
            'https://domeliseu.pa.gov.br',
            'https://www.cruzeiro.rs.gov.br',
            'http://www.sarandi.pr.gov.br/web',
            'https://manicore.am.gov.br',
            'https://www.humaita.am.gov.br',
            'https://sape.pb.gov.br',
            'http://pe.portaldatransparencia.com.br/prefeitura/palmares',
            'https://conceicaodocoite.ba.gov.br',
            'https://www.casanova.ba.gov.br',
            'https://www.abaetetuba.pa.gov.br',
            'http://santaines.ma.gov.br',
            'https://www.braganca.pa.gov.br',
            'https://tutoia.ma.gov.br',
            'http://www.ouricuri.pe.gov.br/novosite',
            'https://www.itapecurumirim.ma.gov.br',
            'https://www.benevides.pa.gov.br',
            'https://www.marituba.pa.gov.br/site',
            'https://www.barreirinhas.ma.gov.br',
            'http://www.tailandia.pa.gov.br',
            'http://www.coroata.ma.gov.br',
            'https://www.araci.ba.gov.br',
            'https://www.tabatinga.sp.gov.br/ind',
            'https://obidos.pa.gov.br',
            'http://www.pmsaraguaia.pa.gov.br',
            'https://www.lagodapedra.ma.gov.br',
            'https://www.capanema.pa.gov.br',
            'http://www.japeri.rj.gov.br',
            'https://www.juruti.pa.gov.br',
            'https://pinheiro.ma.gov.br',
            'http://www.itacoatiara.am.gov.br',
            'https://buriticupu.ma.gov.br',
            'https://www.ipira.sc.gov.br',
            'https://itupiranga.pa.gov.br',
            'https://www.montealegre.pa.gov.br',
            'https://www.zedoca.ma.gov.br',
            'https://www.prefeituratomeacu.pa.gov.br',
            'http://www.breubranco.pa.gov.br',
            'https://vigia.pa.gov.br',
            'http://coari.am.gov.br',
            'http://barra.ba.gov.br',
            'https://acara.pa.gov.br',
            'https://www.euclidesdacunha.ba.gov.br',
            'https://www.maues.am.gov.br',
            'https://ruropolis.pa.gov.br/site',
            'https://buique.pe.gov.br',
            'https://www.vargemgrande.ma.gov.br',
            'https://igarapemiri.pa.gov.br',
            'https://alenquer.pa.gov.br',
            'https://portel.pa.gov.br',
            'https://www.viana.ma.gov.br',
            'http://www.laranjaldojari.ap.gov.br',
            'https://www.novorepartimento.pa.gov.br/web',
            'https://www.barradocorda.ma.gov.br',
            'http://portal.santaluzia.ma.gov.br',
            'https://www.capitaopoco.pa.gov.br/princip',
            'http://www.viseu.pa.gov.br',
            'https://www.sfxingu.pa.gov.br',
            'https://ipixunadopara.pa.gov.br',
            'https://moju.pa.gov.br'

        ]
        self.subdomain_exclusions = subdomain_exclusions
        self.crawl_js = crawl_js
        # boolean command line parameters are not converted from strings automatically
        if str(crawl_js).lower() in ['true', 't', 'yes', 'y', '1']:
            self.crawl_js = True

    def parse(self, response):
        # print("Parsing ", response.url)
        all_urls = set()

        # use xpath selectors to find all the links, this proved to be more effective than using the
        #  scrapy provided LinkExtractor during testing
        selector = scrapy.Selector(response)

        # grab all hrefs from the page
        # print(selector.xpath('//a/@href').extract())
        all_urls.update(selector.xpath('//a/@href').extract())
        # also grab all sources, this will yield a bunch of binary files which we will filter out
        # below, but it has the useful property that it will also grab all javavscript files links
        # as well, we need to scrape these for urls to uncover js code that yields up urls when
        # executed! An alternative here would be to drive the scraper via selenium to execute the js
        # as we go, but this seems slightly simpler
        all_urls.update(selector.xpath('//@src').extract())

        # custom regex that works on javascript files to extract relativel urls hidden in quotes.
        # This is a workaround for sites that need js executed in order to follow links -- aka
        # single-page angularJS type designs that have clickable menu items that are not rendered
        # into <a> elements but rather as clickable span elements - e.g. jana.com
        all_urls.update(selector.re('"(\/[-\w\d\/\._#?]+?)"'))

        for found_address in selector.re('[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}'):
            item = EmailAddressItem()
            item['email_address'] = found_address
            yield item

        for url in all_urls:
            # ignore commonly ignored binary extensions - might want to put PDFs back in list and
            # parse with a pdf->txt extraction library to strip emails from whitepapers, resumes,
            # etc.
            extension = get_extension_ignore_url_params(url)
            if extension in IGNORED_EXTENSIONS:
                continue
            # convert all relative paths to absolute paths
            if 'http' not in url:
                url = urljoin(response.url, url)
            if extension.lower() != 'js' or self.crawl_js is True:
                yield scrapy.Request(url, callback=self.parse)
